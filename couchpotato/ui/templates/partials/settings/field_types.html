{# Field Types - All form field templates for settings #}
{# Requires Alpine context: group, opt, showAdvanced, getVal(), setVal(), buildDescription(), hasLearnMore(), getLearnMore() #}

<!-- Bool / checkbox -->
<template x-if="opt.type === 'bool'">
  <div>
    <label class="flex items-center gap-2 cursor-pointer">
      <input type="checkbox"
             :checked="getVal(group.section, opt.name)"
             @change="setVal(group.section, opt.name, $event.target.checked)"
             :aria-label="opt.label || opt.name.replace(/_/g, ' ')"
             class="rounded border-white/[0.1] bg-white/[0.03] text-cp-accent focus:ring-cp-accent/30">
      <span class="text-[11px] text-cp-muted" x-html="buildDescription(group.section, opt)"></span>
    </label>
    <template x-if="hasLearnMore(group.section, opt.name)">
      <details class="mt-2 text-[10px]">
        <summary class="text-cp-accent cursor-pointer hover:underline">Learn more</summary>
        <div class="mt-1.5 p-2 rounded bg-white/[0.02] border border-white/[0.04] text-cp-muted leading-relaxed" x-html="getLearnMore(group.section, opt.name)"></div>
      </details>
    </template>
  </div>
</template>

<!-- Dropdown / select -->
<template x-if="opt.type === 'dropdown'">
  <div>
    <select @change="setVal(group.section, opt.name, $event.target.value)"
            :aria-label="opt.label || opt.name.replace(/_/g, ' ')"
            class="w-full bg-white/[0.03] border border-white/[0.06] rounded-md px-3 py-2 text-xs focus:outline-none focus:border-cp-accent/30">
      <template x-for="v in (opt.values || [])" :key="JSON.stringify(v)">
        <option :value="Array.isArray(v) ? v[1] : v"
                :selected="String(getVal(group.section, opt.name)) === String(Array.isArray(v) ? v[1] : v)"
                x-text="Array.isArray(v) ? v[0] : v"></option>
      </template>
    </select>
    <p class="text-[10px] text-cp-muted mt-1.5 leading-relaxed" x-html="buildDescription(group.section, opt)"></p>
    <template x-if="hasLearnMore(group.section, opt.name)">
      <details class="mt-2 text-[10px]">
        <summary class="text-cp-accent cursor-pointer hover:underline">Learn more</summary>
        <div class="mt-1.5 p-2 rounded bg-white/[0.02] border border-white/[0.04] text-cp-muted leading-relaxed" x-html="getLearnMore(group.section, opt.name)"></div>
      </details>
    </template>
  </div>
</template>

<!-- Password -->
<template x-if="opt.type === 'password'">
  <div>
    <input type="password"
           :value="getVal(group.section, opt.name)"
           @input="setVal(group.section, opt.name, $event.target.value)"
           :aria-label="opt.label || opt.name.replace(/_/g, ' ')"
           class="w-full bg-white/[0.03] border border-white/[0.06] rounded-md px-3 py-2 text-xs focus:outline-none focus:border-cp-accent/30">
    <p class="text-[10px] text-cp-muted mt-1.5 leading-relaxed" x-html="buildDescription(group.section, opt)"></p>
    <template x-if="hasLearnMore(group.section, opt.name)">
      <details class="mt-2 text-[10px]">
        <summary class="text-cp-accent cursor-pointer hover:underline">Learn more</summary>
        <div class="mt-1.5 p-2 rounded bg-white/[0.02] border border-white/[0.04] text-cp-muted leading-relaxed" x-html="getLearnMore(group.section, opt.name)"></div>
      </details>
    </template>
  </div>
</template>

<!-- Int / Float (number) -->
<template x-if="opt.type === 'int' || opt.type === 'float'">
  <div>
    <input type="number" 
           :step="opt.type === 'float' ? '0.1' : '1'"
           :value="getVal(group.section, opt.name)"
           @input="setVal(group.section, opt.name, $event.target.value)"
           :aria-label="opt.label || opt.name.replace(/_/g, ' ')"
           class="w-full bg-white/[0.03] border border-white/[0.06] rounded-md px-3 py-2 text-xs focus:outline-none focus:border-cp-accent/30">
    <p class="text-[10px] text-cp-muted mt-1.5 leading-relaxed" x-html="buildDescription(group.section, opt)"></p>
    <template x-if="hasLearnMore(group.section, opt.name)">
      <details class="mt-2 text-[10px]">
        <summary class="text-cp-accent cursor-pointer hover:underline">Learn more</summary>
        <div class="mt-1.5 p-2 rounded bg-white/[0.02] border border-white/[0.04] text-cp-muted leading-relaxed" x-html="getLearnMore(group.section, opt.name)"></div>
      </details>
    </template>
  </div>
</template>

<!-- Text (default / string) -->
<template x-if="!opt.type || opt.type === 'string'">
  <div>
    <input type="text"
           :value="getVal(group.section, opt.name)"
           @input="setVal(group.section, opt.name, $event.target.value)"
           :placeholder="opt.placeholder || (opt.default != null ? String(opt.default) : '')"
           :aria-label="opt.label || opt.name.replace(/_/g, ' ')"
           class="w-full bg-white/[0.03] border border-white/[0.06] rounded-md px-3 py-2 text-xs focus:outline-none focus:border-cp-accent/30">
    <p class="text-[10px] text-cp-muted mt-1.5 leading-relaxed" x-html="buildDescription(group.section, opt)"></p>
    <template x-if="hasLearnMore(group.section, opt.name)">
      <details class="mt-2 text-[10px]">
        <summary class="text-cp-accent cursor-pointer hover:underline">Learn more</summary>
        <div class="mt-1.5 p-2 rounded bg-white/[0.02] border border-white/[0.04] text-cp-muted leading-relaxed" x-html="getLearnMore(group.section, opt.name)"></div>
      </details>
    </template>
  </div>
</template>

<!-- Button (action button like Jackett sync) -->
<template x-if="opt.type === 'button'">
  <div x-data="buttonField(group.section, opt)">
    <button @click="execute()" 
            :disabled="running"
            :aria-label="opt.button_text || opt.label || 'Execute'"
            class="px-4 py-2 rounded-md text-xs font-medium bg-cp-accent/20 text-cp-accent hover:bg-cp-accent/30 transition-colors disabled:opacity-50">
      <span x-show="!running" x-text="opt.button_text || 'Execute'"></span>
      <span x-show="running" class="flex items-center gap-2">
        <svg aria-hidden="true" class="w-3 h-3 animate-spin" viewBox="0 0 24 24" fill="none">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/>
        </svg>
        Runningâ€¦
      </span>
    </button>
    <div x-show="result" class="mt-2 text-xs" :class="success ? 'text-cp-success' : 'text-cp-danger'" x-text="result" role="status"></div>
    <p class="text-[10px] text-cp-muted mt-1.5 leading-relaxed" x-html="buildDescription()"></p>
  </div>
</template>

<!-- Directory (single path with browse) -->
<template x-if="opt.type === 'directory'">
  <div>
    <div class="flex gap-2">
      <input type="text"
             :value="getVal(group.section, opt.name)"
             @input="setVal(group.section, opt.name, $event.target.value)"
             :placeholder="opt.default != null ? String(opt.default) : '/path/to/folder'"
             :aria-label="opt.label || opt.name.replace(/_/g, ' ')"
             class="flex-1 bg-white/[0.03] border border-white/[0.06] rounded-md px-3 py-2 text-xs focus:outline-none focus:border-cp-accent/30">
      <button @click="browseDirectory(group.section, opt.name)" 
              type="button"
              :aria-label="'Browse for ' + (opt.label || opt.name.replace(/_/g, ' '))"
              class="px-3 py-2 rounded-md text-xs bg-white/[0.04] text-cp-muted hover:text-cp-text hover:bg-white/[0.06] transition-colors shrink-0">
        Browse
      </button>
    </div>
    <p class="text-[10px] text-cp-muted mt-1.5 leading-relaxed" x-html="buildDescription(group.section, opt)"></p>
    <template x-if="hasLearnMore(group.section, opt.name)">
      <details class="mt-2 text-[10px]">
        <summary class="text-cp-accent cursor-pointer hover:underline">Learn more</summary>
        <div class="mt-1.5 p-2 rounded bg-white/[0.02] border border-white/[0.04] text-cp-muted leading-relaxed" x-html="getLearnMore(group.section, opt.name)"></div>
      </details>
    </template>
  </div>
</template>

<!-- Directories (multi-path) -->
<template x-if="opt.type === 'directories'">
  <div class="sm:col-span-2" x-data="directoriesField(group.section, opt)">
    <template x-for="(dir, dirIdx) in dirs" :key="dirIdx">
      <div class="flex gap-2 mb-2 items-center">
        <input type="text" 
               :value="dir"
               @input="updateDir(dirIdx, $event.target.value)"
               placeholder="/path/to/movies"
               :aria-label="(opt.label || opt.name) + ' path ' + (dirIdx + 1)"
               class="flex-1 bg-white/[0.03] border border-white/[0.06] rounded-md px-3 py-1.5 text-xs focus:outline-none focus:border-cp-accent/30">
        <button @click="browseDir(dirIdx)" 
                type="button"
                :aria-label="'Browse for folder ' + (dirIdx + 1)"
                class="px-2 py-1.5 rounded-md text-xs bg-white/[0.04] text-cp-muted hover:text-cp-text hover:bg-white/[0.06] transition-colors shrink-0">
          Browse
        </button>
        <button @click="removeDir(dirIdx)" 
                class="text-cp-muted hover:text-cp-danger transition-colors shrink-0" 
                :aria-label="'Remove folder ' + (dirIdx + 1)">
          <svg aria-hidden="true" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
    </template>
    <button @click="addDir()" 
            class="text-[11px] text-cp-accent hover:text-cp-accentHover transition-colors" 
            aria-label="Add another folder">+ Add folder</button>
    <p x-show="buildDescription()" class="text-[10px] text-cp-muted mt-1.5 leading-relaxed" x-html="buildDescription()"></p>
    <template x-if="hasLearnMore()">
      <details class="mt-2 text-[10px]">
        <summary class="text-cp-accent cursor-pointer hover:underline">Learn more</summary>
        <div class="mt-1.5 p-2 rounded bg-white/[0.02] border border-white/[0.04] text-cp-muted leading-relaxed" x-html="getLearnMore()"></div>
      </details>
    </template>
  </div>
</template>

<!-- Combined (multi-entry rows like newznab hosts/keys) -->
<template x-if="opt.type === 'combined'">
  <div x-data="combinedField(group.section, opt)">
    <!-- Column headers -->
    <div class="flex gap-2 mb-2 items-center text-[10px] text-cp-muted font-medium" aria-hidden="true">
      <template x-for="(col, colIdx) in opt.combine" :key="'hdr-'+colIdx">
        <span :class="col === 'use' ? 'w-10 shrink-0 text-center' : (col === 'host' ? 'flex-[2] min-w-0' : 'flex-1 min-w-0')" 
              x-text="col === 'use' ? '' : col.replace(/_/g, ' ')"></span>
      </template>
      <span class="w-4 shrink-0"></span>
    </div>
    
    <!-- Data rows -->
    <template x-for="(row, rowIdx) in rows" :key="rowIdx">
      <div class="flex gap-2 mb-2 items-center">
        <template x-for="(col, colIdx) in opt.combine" :key="colIdx">
          <div :class="col === 'use' ? 'w-10 shrink-0 flex justify-center' : (col === 'host' ? 'flex-[2] min-w-0' : 'flex-1 min-w-0')">
            <!-- Toggle for 'use' column -->
            <template x-if="col === 'use'">
              <button @click="updateRow(rowIdx, colIdx, (row[colIdx] === '1' || row[colIdx] === 1) ? '0' : '1')"
                      :class="(row[colIdx] === '1' || row[colIdx] === 1) ? 'bg-cp-accent' : 'bg-white/[0.08]'"
                      class="relative w-8 h-4 rounded-full transition-colors shrink-0"
                      role="switch"
                      :aria-checked="(row[colIdx] === '1' || row[colIdx] === 1).toString()"
                      :aria-label="'Enable row ' + (rowIdx + 1)">
                <span :class="(row[colIdx] === '1' || row[colIdx] === 1) ? 'translate-x-4' : 'translate-x-0.5'"
                      class="block w-3 h-3 bg-white rounded-full transition-transform absolute top-0.5" aria-hidden="true"></span>
              </button>
            </template>
            <!-- Text input for other columns -->
            <template x-if="col !== 'use'">
              <input type="text" 
                     :placeholder="col.replace(/_/g, ' ')"
                     :value="row[colIdx] || ''"
                     @input="updateRow(rowIdx, colIdx, $event.target.value)"
                     :aria-label="col.replace(/_/g, ' ') + ' for row ' + (rowIdx + 1)"
                     class="w-full bg-white/[0.03] border border-white/[0.06] rounded-md px-3 py-1.5 text-xs focus:outline-none focus:border-cp-accent/30">
            </template>
          </div>
        </template>
        <button @click="removeRow(rowIdx)" 
                class="text-cp-muted hover:text-cp-danger transition-colors shrink-0" 
                :aria-label="'Remove row ' + (rowIdx + 1)">
          <svg aria-hidden="true" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
    </template>
    
    <button @click="addRow()" 
            class="text-[11px] text-cp-accent hover:text-cp-accentHover transition-colors"
            aria-label="Add another row">+ Add</button>
    <p x-show="buildDescription()" class="text-[10px] text-cp-muted mt-1.5 leading-relaxed" x-html="buildDescription()"></p>
    <template x-if="hasLearnMore()">
      <details class="mt-2 text-[10px]">
        <summary class="text-cp-accent cursor-pointer hover:underline">Learn more</summary>
        <div class="mt-1.5 p-2 rounded bg-white/[0.02] border border-white/[0.04] text-cp-muted leading-relaxed" x-html="getLearnMore()"></div>
      </details>
    </template>
  </div>
</template>

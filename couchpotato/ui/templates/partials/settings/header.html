{# Settings Header - Title, version, controls #}
{# Requires Alpine context: version, updateAvailable, showAdvanced, activeTab, saving, lastSaved #}

<div class="flex items-center justify-between mb-6">
  <div class="flex items-center gap-3">
    <h1 class="text-xl font-semibold tracking-tight">Settings</h1>
    <span x-show="version" class="text-[10px] text-cp-muted bg-white/[0.04] px-2 py-0.5 rounded" x-text="'v' + version"></span>
    <template x-if="updateAvailable">
      <span class="text-[10px] text-cp-success bg-cp-success/10 px-2 py-0.5 rounded flex items-center gap-1">
        <svg aria-hidden="true" class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
        </svg>
        <span x-text="updateAvailable.hash + ' available'"></span>
      </span>
    </template>
  </div>
  <div class="flex items-center gap-3">
    <!-- Advanced toggle -->
    <template x-if="activeTab !== 'logs'">
      <label class="flex items-center gap-2 cursor-pointer text-xs text-cp-muted">
        <button @click="showAdvanced = !showAdvanced"
                :class="showAdvanced ? 'bg-cp-accent' : 'bg-white/[0.08]'"
                class="relative w-8 h-4 rounded-full transition-colors shrink-0"
                role="switch"
                :aria-checked="showAdvanced.toString()"
                aria-label="Show advanced settings">
          <span :class="showAdvanced ? 'translate-x-4' : 'translate-x-0.5'"
                class="block w-3 h-3 bg-white rounded-full transition-transform absolute top-0.5" aria-hidden="true"></span>
        </button>
        <span :class="showAdvanced ? 'text-cp-accent' : ''" aria-hidden="true">Advanced</span>
      </label>
    </template>
    
    <!-- Setup Wizard link -->
    <template x-if="activeTab !== 'logs'">
      <a href="{{ new_base }}wizard/" class="px-4 py-1.5 rounded-md text-xs font-medium bg-white/[0.04] text-cp-muted hover:text-cp-text hover:bg-white/[0.06] transition-colors flex items-center gap-1.5">
        <svg aria-hidden="true" class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z"/>
        </svg>
        Setup Wizard
      </a>
    </template>
    
    <!-- Auto-save indicator -->
    <template x-if="activeTab !== 'logs'">
      <div class="flex items-center gap-2 text-xs" role="status" aria-live="polite">
        <span x-show="saving" class="flex items-center gap-1.5 text-cp-muted">
          <svg aria-hidden="true" class="w-3 h-3 animate-spin" viewBox="0 0 24 24" fill="none">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/>
          </svg>
          Savingâ€¦
        </span>
        <span x-show="lastSaved && !saving" class="text-cp-success flex items-center gap-1">
          <svg aria-hidden="true" class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
          </svg>
          Saved
        </span>
      </div>
    </template>
  </div>
</div>

<!-- Update available banner -->
<template x-if="updateAvailable">
  <div class="mb-6 px-4 py-3 rounded-lg bg-cp-success/10 border border-cp-success/20 flex items-center justify-between gap-4">
    <div class="flex items-center gap-3">
      <svg aria-hidden="true" class="w-5 h-5 text-cp-success shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
      </svg>
      <div>
        <p class="text-sm font-medium text-cp-success" x-text="'Update available: ' + updateAvailable.hash"></p>
        <p x-show="updateAvailable.docker_message" class="text-xs text-cp-muted mt-0.5" x-text="updateAvailable.docker_message"></p>
      </div>
    </div>
    <a x-show="updateAvailable.changelog" :href="updateAvailable.changelog" target="_blank"
       class="px-3 py-1.5 rounded-md text-xs font-medium bg-cp-success/20 text-cp-success hover:bg-cp-success/30 transition-colors shrink-0">
      View Changelog <span class="sr-only">(opens in new tab)</span>
    </a>
  </div>
</template>

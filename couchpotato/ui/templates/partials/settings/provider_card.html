{# Provider Card - Standard settings card with collapsible sections #}
{# Requires Alpine context: group, groupIdx, showAdvanced, getVal(), setVal(), etc. #}

<template x-if="!group._isCombined">
<div class="bg-cp-card rounded-lg border border-white/[0.05] overflow-hidden max-w-full">
  <!-- Group header -->
  <div class="flex items-center justify-between px-5 py-3"
       :class="[
         isGroupOpen(groupKey(group, groupIdx)) && (getEnabler(group) ? isEnabled(group) : true) ? 'border-b border-white/[0.04]' : '',
         getEnabler(group) ? 'cursor-pointer' : ''
       ]"
       @click="getEnabler(group) && toggleGroup(groupKey(group, groupIdx))">
    <div class="flex items-center gap-3">
      <!-- Enabler toggle if group has one -->
      <template x-if="getEnabler(group)">
        <button @click.stop="toggleEnabler(group)"
                :class="isEnabled(group) ? 'bg-cp-accent' : 'bg-white/[0.08]'"
                class="relative w-8 h-4 rounded-full transition-colors shrink-0"
                role="switch"
                :aria-checked="isEnabled(group).toString()"
                :aria-label="'Enable ' + (group.label || group.name)">
          <span :class="isEnabled(group) ? 'translate-x-4' : 'translate-x-0.5'"
                class="block w-3 h-3 bg-white rounded-full transition-transform absolute top-0.5" aria-hidden="true"></span>
        </button>
      </template>
      <div>
        <h3 class="text-sm font-medium" x-text="group.label || group.name"></h3>
        <p x-show="group.description" class="text-[11px] text-cp-muted mt-0.5" x-html="group.description"></p>
      </div>
    </div>
    <!-- Chevron for collapsible groups -->
    <template x-if="getEnabler(group)">
      <svg aria-hidden="true" class="w-4 h-4 text-cp-muted transition-transform" :class="isGroupOpen(groupKey(group, groupIdx)) ? 'rotate-180' : ''" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"/>
      </svg>
    </template>
  </div>

  <!-- Group options -->
  <div x-show="getEnabler(group) ? isGroupOpen(groupKey(group, groupIdx)) : true" x-transition class="px-5 py-4 overflow-hidden">
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4 overflow-hidden">
      <template x-for="opt in getGroupOptions(group)" :key="group.section + '.' + opt.name">
        <div x-show="opt.type !== 'enabler' && (showAdvanced || !opt.advanced) && isOptionVisible(opt, group)"
             :class="(opt.type === 'directory' || opt.type === 'directories' || opt.type === 'combined' || opt.type === 'button') ? 'sm:col-span-2' : ''">
          <label x-show="opt.type !== 'combined' && opt.type !== 'bool'" 
                 class="block text-xs text-cp-muted mb-1.5" 
                 x-text="opt.label || opt.name.replace(/_/g, ' ')"></label>

          {% include "partials/settings/field_types.html" %}
        </div>
      </template>
    </div>

    <!-- Test button for providers -->
    {% include "partials/settings/test_button.html" %}
  </div>
</div>
</template>

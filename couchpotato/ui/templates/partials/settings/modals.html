{# Settings Modals & Overlays #}
{# Requires Alpine context: needsRestart, restartApp(), message, messageType, browserOpen, etc. #}

<!-- Restart banner -->
<div x-show="needsRestart" x-transition 
     class="fixed bottom-4 left-1/2 -translate-x-1/2 z-50 flex items-center gap-3 px-5 py-3 rounded-lg bg-cp-warning/20 border border-cp-warning/30 backdrop-blur-sm"
     role="alert">
  <span class="text-xs text-cp-warning font-medium">Some changes need a restart to take effect.</span>
  <button @click="restartApp()" 
          class="px-3 py-1 rounded-md text-xs font-medium bg-cp-warning text-black hover:opacity-90 transition-opacity">
    Restart
  </button>
</div>

<!-- Toast notification -->
<div x-show="message" 
     x-transition 
     class="fixed bottom-4 right-4 lg:bottom-8 lg:right-8 z-50 px-4 py-2 rounded-md text-xs font-medium"
     :class="messageType === 'success' ? 'bg-cp-success/20 text-cp-success' : 'bg-cp-danger/20 text-cp-danger'"
     x-text="message"
     role="status"
     aria-live="polite"></div>

<!-- Directory Browser Modal -->
<div x-show="browserOpen" 
     x-transition 
     class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
     role="dialog"
     aria-modal="true"
     aria-labelledby="browser-title"
     @keydown.escape.window="if(browserOpen) browserOpen = false">
  <div class="bg-cp-card rounded-xl border border-white/[0.05] w-full max-w-lg mx-4 max-h-[80vh] flex flex-col"
       @keydown.tab="
         const focusable = $el.querySelectorAll('button:not([disabled])');
         const first = focusable[0];
         const last = focusable[focusable.length - 1];
         if ($event.shiftKey && document.activeElement === first) {
           $event.preventDefault();
           last.focus();
         } else if (!$event.shiftKey && document.activeElement === last) {
           $event.preventDefault();
           first.focus();
         }
       ">
    <!-- Header -->
    <div class="px-4 py-3 border-b border-white/[0.04] flex items-center justify-between">
      <h3 id="browser-title" class="text-sm font-medium">Browse Folders</h3>
      <button @click="browserOpen = false" 
              class="text-cp-muted hover:text-cp-text"
              aria-label="Close folder browser">
        <svg aria-hidden="true" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    
    <!-- Path bar -->
    <div class="px-4 py-2 border-b border-white/[0.04] bg-white/[0.02]">
      <div class="flex items-center gap-2 text-xs">
        <button @click="loadDirectories(browserParent)" 
                :disabled="browserIsRoot" 
                class="px-2 py-1 rounded bg-white/[0.04] text-cp-muted hover:text-cp-text hover:bg-white/[0.06] disabled:opacity-30 disabled:cursor-not-allowed"
                aria-label="Go up one folder">
          ↑ Up
        </button>
        <span class="text-cp-muted font-mono truncate" x-text="browserPath" aria-label="Current path"></span>
      </div>
    </div>
    
    <!-- Directory list -->
    <div class="flex-1 overflow-y-auto min-h-[200px] max-h-[400px]" role="listbox" aria-label="Folders">
      <!-- Loading -->
      <div x-show="browserLoading" class="flex items-center justify-center py-8" role="status">
        <svg aria-hidden="true" class="w-4 h-4 animate-spin text-cp-muted" viewBox="0 0 24 24" fill="none">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/>
        </svg>
        <span class="sr-only">Loading folders…</span>
      </div>
      
      <!-- Empty state -->
      <div x-show="!browserLoading && browserDirs.length === 0" class="py-8 text-center text-xs text-cp-muted">
        Empty folder
      </div>
      
      <!-- Directory items -->
      <template x-for="dir in browserDirs" :key="dir">
        <button @click="selectDirectory(dir)" 
                role="option"
                class="w-full px-4 py-2 text-left text-xs hover:bg-white/[0.04] flex items-center gap-2 border-b border-white/[0.02]">
          <svg aria-hidden="true" class="w-4 h-4 text-cp-accent shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z"/>
          </svg>
          <span class="truncate" x-text="dir.split('/').filter(Boolean).pop() || dir"></span>
        </button>
      </template>
    </div>
    
    <!-- Footer -->
    <div class="px-4 py-3 border-t border-white/[0.04] flex justify-end gap-2">
      <button @click="browserOpen = false" 
              class="px-4 py-2 rounded-md text-xs font-medium text-cp-muted hover:text-cp-text">
        Cancel
      </button>
      <button @click="confirmDirectory()" 
              class="px-4 py-2 rounded-md text-xs font-medium bg-cp-accent text-black hover:bg-cp-accentHover">
        Select This Folder
      </button>
    </div>
  </div>
</div>

{# Test Button - Provider testing with results display #}
{# Requires Alpine context: group, testing, testResult, testResultDetails, testProvider() #}

<template x-if="group.list">
  <div class="mt-4 pt-3 border-t border-white/[0.04]">
    <button @click="testProvider(group)" 
            :disabled="testing === group.section"
            :aria-label="'Test ' + group.label + ' connection'"
            class="px-3 py-1.5 rounded-md text-[11px] font-medium bg-white/[0.04] text-cp-muted hover:text-cp-text hover:bg-white/[0.06] transition-colors disabled:opacity-50">
      <span x-show="testing !== group.section">Test <span x-text="group.label"></span></span>
      <span x-show="testing === group.section" class="flex items-center gap-2">
        <svg aria-hidden="true" class="w-3 h-3 animate-spin" viewBox="0 0 24 24" fill="none">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/>
        </svg>
        Testing…
      </span>
    </button>
    
    <!-- Simple result for single-entry providers -->
    <span x-show="testResult[group.section] && !testResultDetails[group.section]"
          :class="testResult[group.section] === 'success' ? 'text-cp-success' : 'text-cp-danger'"
          class="ml-2 text-[11px]" 
          x-text="testResult[group.section]"
          role="status"></span>
    
    <!-- Detailed results for multi-entry providers -->
    <div x-show="testResultDetails[group.section]" class="mt-2 space-y-1" role="status" aria-live="polite">
      <template x-for="(detail, idx) in (testResultDetails[group.section] || [])" :key="idx">
        <div class="flex items-center gap-2 text-[11px]">
          <span :class="detail.success ? 'text-cp-success' : 'text-cp-danger'" class="shrink-0" aria-hidden="true">
            <template x-if="detail.success">✓</template>
            <template x-if="!detail.success">✗</template>
          </span>
          <span class="sr-only" x-text="detail.success ? 'Success:' : 'Failed:'"></span>
          <span class="text-cp-muted truncate" x-text="detail.host"></span>
          <span x-show="detail.error" class="text-cp-danger/70 truncate" x-text="detail.error"></span>
        </div>
      </template>
    </div>
  </div>
</template>

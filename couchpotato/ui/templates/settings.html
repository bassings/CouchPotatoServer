{% extends "base.html" %}
{% block title %}Settings — CouchPotato{% endblock %}
{% block content %}
<div class="p-4 lg:p-8 fade-in" x-data="settingsPanel()" x-init="init()">
  
  {# ==================== HEADER ==================== #}
  {% include "partials/settings/header.html" %}

  {# ==================== LOADING STATE ==================== #}
  <div x-show="loading" class="flex items-center justify-center py-20" role="status" aria-live="polite">
    <div class="flex items-center gap-3 text-cp-muted text-sm">
      <svg aria-hidden="true" class="w-4 h-4 animate-spin" viewBox="0 0 24 24" fill="none">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/>
      </svg>
      <span>Loading settings…</span>
    </div>
  </div>

  <div x-show="!loading" x-cloak>
    {# ==================== TABS ==================== #}
    <div class="flex flex-wrap gap-1 mb-6 overflow-x-auto scrollbar-hide" role="tablist" aria-label="Settings categories">
      <template x-for="tab in tabOrder" :key="tab">
        <button @click="activeTab = tab"
                role="tab"
                :aria-selected="activeTab === tab"
                :id="'tab-' + tab"
                :class="activeTab === tab ? 'bg-cp-accent text-white shadow-md' : 'bg-white/[0.06] text-cp-muted hover:text-cp-text hover:bg-white/[0.10]'"
                class="px-4 py-2 rounded-lg transition-all text-sm font-medium" 
                x-text="tabLabels[tab] || tab"></button>
      </template>
    </div>

    {# ==================== LOGS TAB ==================== #}
    {% include "partials/settings/logs_tab.html" %}

    {# ==================== SETTINGS TABS ==================== #}
    <div x-show="activeTab !== 'logs'" class="space-y-4">
      <template x-for="(group, groupIdx) in currentGroups" :key="groupIdx">
        <div x-show="!group.advanced || showAdvanced">
          
          {# Category Header #}
          <template x-if="shouldShowCategoryHeader(groupIdx)">
            <h2 class="text-xs font-semibold text-cp-accent uppercase tracking-wide mb-3 mt-6 first:mt-0" 
                x-text="getCategoryLabel(groupIdx)"></h2>
          </template>
          
          {# Combined Basics Card (searcher tab) #}
          {% include "partials/settings/combined_basics_card.html" %}
          
          {# Regular Provider Card #}
          {% include "partials/settings/provider_card.html" %}
          
        </div>
      </template>
    </div>
  </div>

  {# ==================== MODALS & OVERLAYS ==================== #}
  {% include "partials/settings/modals.html" %}
  
</div>

{# ==================== ALPINE.JS COMPONENTS ==================== #}
{% include "partials/settings/scripts.html" %}
{% endblock %}
